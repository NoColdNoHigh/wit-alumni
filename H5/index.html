<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no, target-densitydpi=device-dpi">
    <meta name="keywords" content="校友录，校友会,手机校友录，慧脑校友录">
    <meta name="description" content="慧脑校友录,手机校友录，校友会">
    <link rel="stylesheet" type="text/css" href="../css/alumni.css">
    <link rel="stylesheet" type="text/css" href="../css/witcs.css">
    <script src="../js/witjs.js"></script>
    <title>校友录</title>
</head>
<body class="ofa bgc10" onload="loadend()" onresize="autocss()">
<div id="s_select" class="none index999 fix bottom0 W11 CH callnone"></div>
<div class="index99 fix top0 H W11 AC ffHT color1 nav">慧脑校友录
    <img data-src='../images/icon/xy2.png' class="FL B4M H4M" onclick=""/>
    <img data-src='../images/icon/setting.png' class="FR ICON P05M"
         onclick=" _wit.postmessage({functionname: 'setting', callback: ''});"/>
</div>
<div class="H4M LH25 AC color8 bold bgc10" id="up_reload">下拉刷新</div>
<div class="W11 AC bgbody CHNHmin" id="mymsg">
    <div class="W11" id="mymsg_s">

        <img data-src="../images/lantian.png" class="W11 AC">
        <div class="W11 AC F3">
            <!--头像-->
            <img id="myImg" data-src="../images/port03.jpg" class="B6M H6M radius"
                 onerror="this.src ='../images/port03.jpg' "
                 onclick="window.open('msg.html')">
        </div>
        <div id="class">
            <p id="class_p" class="bold F5 LH2 P1 ffKT color1">我的班级</p>
            <ul id="myclass" class="clear ffHT color1"></ul>
            <a>
                <img data-src="../images/icon/add.png" alt="" class="AC MA H2M MT" onclick="show_add()">
            </a>
        </div>
        <div id="focus">
            <p class="bold F5 LH2 P1 ffKT color1">我的关注</p>
            <ul id="myfocus" class="clear ffHT color1"></ul>
            <a>
                <img data-src="../images/icon/add.png" alt="" class="AC MA H2M MT"
                     onclick="_wd.info('此功能暂未开放，敬请期待！','bgc5e')">
            </a>
        </div>
        <div id="fill_height" class="relative bgbody">
            <img data-src="../images/caodi.png" id="bt_img" class="absolute bottom0  left0 W11  AC ">
        </div>

    </div>
</div>

<!-- 添加班级开始 -->
<div id="d_add" class="none W11 ffWRYH CH fix index100 top0 bgca8b">
    <div class="CW CH fix ofa " onclick="_fun.hide(this.parentNode);"></div>
    <div class="relative W11 MT2H  rad05e LSP ffWRYH">
        <div class="CW H AC" id="add_tip">填写班级信息</div>
        <input name="industrycode" data-id="industry_code" placeholder="学校类别"
               class="rad05e clear FL MLT B10M H AL bgc107 bord_select" readonly="" data-t="radio"
               data-finp="clearschoolname"
               data-s="幼儿园,小学,初中,高中,中职,大学,研博,培训,特殊,其他" title="-1" value=""/>
        <input name="admdivcode" data-d="title" data-id="adm_div_code" placeholder="选择学校地域" readonly=""
               class="rad05e FL MLT C13MT2 H ALP bgc10 bord0 bord_select" value="" title=""
               onmousedown="creat_addr(3,0);"/>
        <input name="schoolname" data-id="unit_name" placeholder="选择学校" type="text"
               class="rad05e FL MLT A1T2 H ALP bord_select" value="" onclick="toSchool()" title="undefined"
               data-uid="undefined" readonly/>
        <!-- <div name="del" class="FR MRT B4M H AC radius bgc15 none">删</div> -->
        <input name="selectdate" data-id="date_start" placeholder="入学日期" readonly
               class=" rad05e FL MLT A21 H ALP border bord_select" onclick="wit_date.init(this,0, '012');"/>
        <div class="FL MT B1M H AC color1">-</div>
        <input name="selectdate" data-id="date_end" placeholder="毕业日期" readonly
               class="rad05e FL MT A21 H ALP border bord_select" onclick="wit_date.init(this,0, '012');"/>
        <div name="group" data-id="class_name" id="d_class"
             class="color75 rad05e  FL MLT A1T2 H ALP bord_select"
             data-in="title"
             required onclick="selectClass();">选择班级
        </div>
        <textarea data-id="honors" class="FL rad05e MLT A1T2 HN4M F4 ALP color75 bord0"
                  placeholder="请输入成绩和荣誉"></textarea>
        <div class="rad05e FL MLT B9M H F4 AC bgc36 radH border MB" onclick="_fun.hide('d_add')">返回</div>
        <div name="submit" class="rad05e FR MRT B9M H F4 AC bgc36 radH border MB" id="add_sublime"
             onclick="addEdu(this.parentNode);">
            添加
        </div>

        <div class="clear"></div>
    </div>
</div>
<!-- 添加班级结束 -->
</body>
</html>
<script src="../js/wit_ajax.js"></script>
<script src="../js/witconfig.js"></script>
<script src="../js/witjsdate.js"></script>
<script src="../js/witjsaddr.js"></script>
<script src="../js/wit_app.js"></script>
<script src="../js/lib/MD5.js"></script>
<script type="text/javascript">
    "use strict";
    autocss();
    const _url = "http://121.43.233.185/alumnicloudweb";
    // const lo_url = "http://www.witknow.com/ljj/school/H5/Classmates.html";
    const lo_url = "Classmates.html";
    var myclass, myObject, myPrivacy, myPersocial, myEduJson;
    var _userguid, _token, _phone, _logoPic;
    var base64img = "";

    function loadend() {
        loadimg();
        _wd.up_refresh("d_add");
        _wit.postmessage({functionname: "getuser", callback: "callback"});
    }

    function callback(msg) {
        console.log(msg);
        var info = msg.perinfo;
        //获取班级信息
        myclass = info.perexpeducationjson;
        myObject = info.perobjectjson;
        myPrivacy = info.perprivacyobjectjson;
        myPersocial = info.persocialinforobjectjson;
        myEduJson = info.perexpeducationjson;
        C_schoolcata("myclass", myclass);
        _wit.postmessage({functionname: 'getuserinfo', callback: 'init'});
    }

    function init(msg) {
        console.log(msg);
        if (msg.result >= 0) {
            var info = msg.message;
            _wit.event.input_UI("s_select", function (i, v, d) {
                console.log(i, v, d);
            });
            _wit.event.input_limit();
            _userguid = info.user_guid;
            _token = info.token;
            _phone = info.user_phone;

            //获取头像，首选慧联系社交头像，其次正常头像，若无则取默认头像
            if (info.per_portrait_social) {
                _logoPic = info.localpath + info.per_portrait_social;
            } else if (info.per_portrait) {
                _logoPic = info.localpath + info.per_portrait;
            } else {
                _logoPic = "../images/port03.jpg";
            }
            document.getElementById("myImg").src = _logoPic;
            var img = new Image();
            img.src = _logoPic;
            img.onload = function () {
                const cvs = document.createElement("canvas"), ctx = cvs.getContext("2d");
                cvs.width = img.width;
                cvs.height = img.height;
                ctx.drawImage(this, 0, 0, cvs.width, cvs.height);
                base64img = cvs.toDataURL();
            };//将头像转成base64，传给班级通讯录
            if (!myObject.per_full_name) {
                console.log("完善信息");
                _wd.toConfirm("请完善个人信息！", addMsg, reload)
            } else {
                console.log("用户信息已完善");
            }
        } else {
            _wd.info("用户非法，请重新登录！", "bgc24");
            // _fun.toAlert("用户非法，请重新登录！");
        }
    }

    function addMsg() {
        window.open("msg.html");
    }

    function reload() {
        window.location.reload();
    }
    //展现经历
    function C_schoolcata(d, c) {
        document.getElementById(d).innerHTML = "";
        console.log(c);
        c.forEach(function (v) {
            var div = document.createElement("div");
            var cid = _wd.getCut("||", 2, v.class_name);
            var class_name = _wd.getCut("||", 1, v.class_name);
            if (class_name.indexOf("班") < 0) {
                class_name = class_name + "班";
            }
            div.className = "MT MA C9M F3 LH3 AC ellips PL1M PR1M shadow0 bg_contain";
            div.style = "background-image:url(../images/muban1.png)";
            div.onclick = function () {
                console.log(cid);
                //判断是否有cid，慧联系关联的经历缺乏cid，需要手动补充
                if (cid) {
                    window.open(lo_url + "?sid=" + v.unit_id + "&cid=" + cid + "&id=" + v.id);
                } else {
                    _fun.show('d_add');
                    update_exp(v);
                }
            };
            div.innerHTML =
                v.unit_name + v.dept + _wd.getCut("-", 0, v.date_end) + "届" + class_name;
            document.getElementById(d).appendChild(div);
        });
        var fillHeight = document.querySelector("#fill_height");
        var bt_img = document.querySelector("#bt_img");
        // fillHeight.style.height = bt_img + "px";
        var msg = document.querySelector("#mymsg_s");
        if (msg.offsetHeight + bt_img.height + H < CH) {
            bt_img.className = "fix bottom0  left0 W11  AC"
        } else {
            fillHeight.style.height = bt_img.height + "px";
        }
    }
    function show_add() {
        _fun.show('d_add');
        document.getElementById("d_add").setAttribute("data-id","none");
        document.getElementById("add_sublime").innerText = "添加";
        document.getElementById("add_tip").innerText = "填写班级信息";

    }
    function update_exp(v) {
        document.getElementById("add_sublime").innerText = "修改";
        document.getElementById("add_tip").innerText = "完善班级信息";
        var dl = document.getElementById("d_add");
        dl.querySelector("input[name='industrycode']").title = _wd.getCut("||", 1, v.industry_code);
        dl.querySelector("input[name='industrycode']").value = _wd.getCut("||", 0, v.industry_code);
        dl.querySelector("input[name='admdivcode']").value = _wd.getCut("||", 1, v.adm_div_code);
        dl.querySelector("input[name='admdivcode']").title = _wd.getCut("||", 0, v.adm_div_code);
        dl.querySelector("input[name='schoolname']").value = v.unit_name;
        dl.querySelector("input[name='schoolname']").title = v.unit_id;
        dl.querySelector("input[data-id='date_start']").value = v.date_start;
        dl.querySelector("input[data-id='date_start']").dataset.yl = v.date_start;
        dl.querySelector("input[data-id='date_end']").value = v.date_end;
        dl.querySelector("input[data-id='date_end']").dataset.yl = v.date_end;
        dl.querySelector("textarea[data-id='honors']").value = v.honors || "";
        dl.setAttribute("data-id",v.id);
    }


    function del_school(id) {
        console.log(id);
        _wit.postmessage({
            functionname: "deleteexp",
            witparams: JSON.stringify({
                type: 0,
                id: id
            }),
            callbackparam: JSON.stringify({
                type: 0,
                id: id
            }),
            callback: "delExp"
        });
    }

    function delExp(msg, param) {
        console.log("正在删除");
        console.log(msg);
        var j = msg,
            p = JSON.parse(param);
        if (j && j.result >= 0) {
            _wd.info("删除成功！", "bgc5e");

            document.location.reload(); //当前页面
            _fun.show('mydetails');
            //其他端免回调
        } else {//pc端
            var o = p.json;
            console.log(o);
            console.log(p.type);
            p.type === 0 && externalfun.deleteexp(function (msg) {

                console.log(msg);
                _fun.toLoading(-1);
                var j = JSON.parse(msg);
                if (j.result >= 0) {
                    _wd.info("删除成功！", "bgc5e");
                    document.location.reload(); //当前页面
                    _fun.show('mydetails');
                }
            }, p.id, 0);
        }
    }

    function addEdu(pd) {
        var o = {
            adm_div_code: "||",
            class_name: "||",
            date_end: "",
            date_start: "",
            depart: "",
            dept: "",
            honors: "",
            industry_code: "",
            position_name: "",
            relation_tag: "",
            unit_name: "",
            unit_id: "",
            per_user_guid: _userguid,
            exptype: 1
        };
        refill(pd, o); //填充数据
        console.log(o);
        var dl = document.getElementById("d_add");
        var dc = document.getElementById("d_class").title;
        var dl_id = dl.getAttribute("data-id");
        if (o.adm_div_code == "||" || o.date_start.length == 0 || o.date_end.length == 0 || o.unit_name.length == 0) {
            // _fun.toAlert("请将数据填写完整再添加！");
            _wd.info("请将数据填写完整！", "bgc5e");
        } else if (dc == "") {
            _wd.info("请将数据填写完整！", "bgc5e");
        }
        else {
            if (dl_id === "none"){
                _wit.postmessage({
                    functionname: "createexp",
                    witparams: {
                        type: 0,
                        json: JSON.stringify(o)
                    },
                    callbackparam: JSON.stringify({
                        type: 0,
                        json: o
                    }),
                    callback: "cbExp"
                });
            } else {
                o.id = dl_id;
                _wit.postmessage({
                    functionname: "updateexp",
                    witparams: {
                        type: 0,
                        json: JSON.stringify(o)
                    },
                    callbackparam: JSON.stringify({
                        type: 0,
                        json: o
                    }),
                    callback: "updateExp"
                });
            }

            isExist(o.unit_id, _wd.getCut("||", 2, o.class_name), o.honors);
        }
    }
    function updateExp(msg, param) {
        console.log(msg);
        var j = msg,
            p = JSON.parse(param);
        if (j && j.result >= 0) {
            _wd.info("修改成功！", "bgc5e");
            setTimeout(function () {
                document.location.reload(); //当前页面
            }, 1000)
        }else {
            _wd.info("无法添加班级！" + j.result, "bgc24");
        }
    }
    function cbExp(msg, param) {
        console.log("正在添加");
        console.log(msg);
        var j = msg,
            p = JSON.parse(param);
        console.log(p);
        if (j && j.result >= 0) {
            _wd.info("添加成功！", "bgc5e");
            setTimeout(function () {
                document.location.reload(); //当前页面
            }, 1000)
            //其他端免回调
        } else {
            _wd.info("无法添加班级！" + j.result, "bgc24");
        }
    }

    function refill(pd, o) {
        var dl = pd.querySelectorAll("input,textarea"),
            dc = pd.querySelector("input[name='admdivcode']"),
            ds = pd.querySelector("input[name='schoolname']"),
            dcl = pd.querySelector("[name=group]"),
            dclr = pd.querySelector("#d_class"),
            d_type = pd.querySelector("[name=industrycode]"),
            de = document.querySelector("input[data-id='date_end']"),
            date = new Date(de.getAttribute("data-yl"));
        Array.prototype.forEach.call(dl, function (v) {
            for (var i in o) {
                if (i === v.dataset.id) {
                    o[i] = v.dataset.d === "title" ? v.title : v.value.trim();
                }
            }
        });
        var classmate = dclr.innerText.replace(/[^0-9]/ig, "") > 9 ? dclr.innerText.replace(/[^0-9]/ig, "") : "0" + dclr.innerText.replace(/[^0-9]/ig, "");
        o.industry_code += "||" + d_type.title;
        o.unit_id = ds.title;
        o.class_name = "||" + _wd.getCut("：", 0, dclr.innerText) + "||" + dcl.title;
        o.adm_div_code += "||" + dc.value;
        return o;
    } //填充数据
    //判断是否为班级成员
    function isExist(sid, cid, h) {
        const para = {
            token: _token,
            userguid: _userguid,
            cid: cid,
            phone: _phone
        };
        console.log(para);
        _wd.ajax_formdata(_url + "/member/queryByCH.do", true, para, function (msg) {
            var p = JSON.parse(msg);
            console.log(p);
            var len = p.message.length;
            if (len === 0) {
                // _wd.toConfirm("是否加入此班级！", addClassmate, backindex)
                addClassmate(sid, cid, h);
            } else {
                console.log("成员已存在，直接进入班级！");
            }
        }, function (msg) {
            _wd.info("错误！请重新登录！", "bgc24");
        });
    }

    //添加信息到班级成员表中
    function addClassmate(s_id, c_id, honors) {
        console.log("开始添加成员");
        const c = myPrivacy;
        const o = myObject;
        const b = myPersocial;
        var graduation = "";
        myEduJson.forEach(function (v) {
            if (v.industry_code.indexOf("大学") > -1) {
                console.log(v.unit_name);
                graduation = v.unit_name;
            }
        });
        const p = {}, para = {};
        var a = o.per_address.split("||");
        console.log(a.length);
        if (a.length > 1) {
            p.acode = a[1] || " ";
            var addr = a[0].split("@@");
            if (addr.length > 1) {
                p.addr = addr[0] + addr[1] || " ";
            }
        }
        p.cid = c_id;
        p.sid = s_id;
        p.phone = o.per_phone0 || "";
        p.name = o.per_full_name || "";
        p.sex = o.per_sex || 0;
        p.zcode = "";
        p.mail = o.per_email || "";
        p.qq = o.per_qq || "";
        p.wx = o.per_webchat || "";
        p.education = c.per_education || "";
        p.ret = 0;
        p.graduation = graduation || "";
        p.industry = parseInt(parseInt(o.per_industry) / 100) || "";
        p.career = c.per_job_title || "";
        p.honor = honors || "";
        p.comp = o.per_unit_name || "";
        p.dept = o.per_dept || "";
        p.job = o.per_position || "";
        p.birthday = b.per_birth_date || "";
        p.site = 0;
        p.date = new Date().getTime();
        p.checkmember = p.checkrank = p.checkdate = 0;
        para.json = p;
        para.token = _token;
        para.userguid = _userguid;
        para.logo = base64img ? base64img.split(",")[1] : "";
        console.log("成员信息", para);
        _wd.ajax_formdata(_url + "/member/insert.do", true, para, function (msg) {
            var j = JSON.parse(msg);
            console.log(j);
            if (j.result >= 0) {
                setTimeout(function () {
                    _wd.info("个人信息同步成功！", "bgc5e");
                }, 1000)
            } else {
                _wd.info("个人信息同步失败！", "bgc5e");
            }
        }, function (msg) {
            _wd.info("错误！请重新登录！", "bgc24");
        });
    }



    function selectClass() {
        var ds = document.querySelector("input[name='schoolname']").title;
        var dt = document.querySelector("input[name='industrycode']").title;
        var de = document.querySelector("input[data-id='date_end']");

        var date = new Date(de.getAttribute("data-yl"));
        console.log(ds + " " + date.getFullYear() + " " + dt);
        if (ds == "undefined" || dt < 0) {
            _wd.info("请将数据填写完整再选择班级！", "bgc5e");
        }
        else {
            toClassmates(ds, date.getFullYear(), dt, event.target);
        }
    }

    function toClassmates(s, y, t, d) {
        var sy = y + "";
        const para = {
            token: _token,
            userguid: _userguid,
            sid: s,
            type: t,
            sDate: sy
        };
        console.log(para);
        _fun.ajax_formdata(_url + "/class/queryBySTD.do", true, para, function (msg) {
            const j = JSON.parse(msg);
            console.log(j);
            if (j.result >= 0 && j.message.length > 0) {
                _fun.toDownList(document.querySelector("#d_class"), function (a, p) {
                    console.log(a, p);
                    const dd = document.createElement("div"), df = document.createDocumentFragment();
                    dd.className = "relative HN4M HX36M ML A11 ofa";
                    dd.id = "d_classList";
                    a.innerHTML = '';
                    j.message.forEach(function (v) {
                        const div = document.createElement("div");
                        div.className = "relative W11 ALP H bgc18 ellips index10";
                        div.innerHTML = v.name + "班：班主任（" + v.master + "）";
                        div.onclick = function () {
                            _fun.hide(p);
                            console.log(this);
                            d.innerHTML = v.name + "班：班主任（" + v.master + "）";
                            d.title = v.guid;
                        };
                        df.appendChild(div);
                    });
                    dd.appendChild(df);
                    a.appendChild(dd);
//                    a.style.bottom = "";
//                    a.style.top = d.offsetTop + H + "px";
                })
            } else {
                _wd.info("错误！没有找到相应班级！" , "bgc24");
            }
        });
    }

    /***
     *  云录关联（经历）
     */
    function toSchool() {
        var t = event.target,
            p = t.parentNode,
            dt = p.querySelector("[name=industrycode]"),
            da = p.querySelector("[name=admdivcode]"),
            type = dt.title,
            area = da.title;
        if (!type || type < 0) {
            _wd.info("请选择学校类别！", "bgc5e");
            dt.click();
            return;
        }
        if (!area) {
            _wd.info("请选择学校所在地址！", "bgc5e");
            da.click();
            return;
        }
        var para = {
            token: _token,
            userguid: _userguid,
            sctype: type,
            adnum: area
        };
        console.log(para);
        _fun.ajax_formdata(_wit.path.server + "mavenwitlinkweb/school/retrieveschool.do", true, para, function (msg) {
            var j = JSON.parse(msg);
            console.log(j, t.screenTop);
            _fun.toDownList(t, function (a, p) {
                var dd = document.createElement("div"),
                    l = j.message,
                    dg = document.createDocumentFragment();
                dd.className = "relative HX24M ML A11 ofa";
                dd.id = "d_schoolList";
                a.innerHTML = "";
                var div = document.createElement("DIV");
                div.innerHTML = '<input type="text" class="FL relative C8M ALP H bgc10 ellips index10" placeholder="如没有您所在的学校，请手动添加" />' +
                    '<div class="FL B6M AC H bgc105">提交</div>';
                dg.appendChild(div);
                dg.querySelector("div>div").onclick = function () {
                    return;
                    var d = this.previousElementSibling,
                        dv = d.value.trim(),
                        ds = document.querySelector("#d_schoolList");
                    if (dv.length <= 0) {
                        d.focus();
                        return;
                    }
                    var ix = l.findIndex(function (v) {
                        return v.sc_name == dv;
                    });
                    if (ix >= 0) {
                        _wd.info("该学校已经存在！", "bgc5e");
                        ds.scrollTop = ds.children[ix + 1].offsetTop;
                        return;
                    }
                    var para = {
                        token: _token,
                        userguid: _userguid,
                        schooljson: {
                            id: "0",
                            sc_name: dv,
                            ad_num: (da.title + "0000").substring(0, 6),
                            sc_type: dt.title,
                            sc_id: 9000000000 + 100000000 * dt.title + 100 * (da.title + "0000").substring(0, 6) + 1 * l.length //最新编码
                            //dt.title + "" + (da.title + "0000").substring(0, 6) + "" + (l.length + 1)
                        }
                    };
                    console.log("自定义学校添加school/create:", para);
                    _fun.ajax_formdata(_wit.path.server + "mavenwitlinkweb/school/createschool.do", true, para, function (msg) {
                        console.log(msg);
                        var j = JSON.parse(msg);
                        if (j.result >= 0) {
                            // _fun.toAlert("添加成功！");
                            _wd.info("添加成功！", "bgc5e");
                            div = document.createElement("div");
                            div.className = "relative W11 ALP H bgc18 ellips index10";
                            div.setAttribute("readonly", "true");
                            div.dataset.id = para.schooljson.sc_id;
                            div.dataset.type = para.schooljson.sc_type;
                            div.innerHTML = para.schooljson.sc_name;
                            div.onclick = function () {
                                t.value = para.schooljson.sc_name;
                                t.title = para.schooljson.sc_id;
                                _fun.hide(p);
                                document.body.style.overflow = "";
                            };
                            ds.appendChild(div);
                            //                            ds.scrollTop = ds.children[ds.childElementCount - 1].offsetTop;
                        } else {
                            _wd.info("添加失败！" + j.message, "bgc24");
                        }
                        // _fun.toAlert("添加失败！" + j.message);
                    });
                };
                l.forEach(function (v) {
                    div = document.createElement("div");
                    div.className = "relative W11 ALP H bgc18 ellips index10";
                    div.setAttribute("readonly", "true");
                    div.dataset.id = v.sc_id;
                    div.dataset.type = v.sc_type;
                    div.innerHTML = v.sc_name;
                    div.onclick = function () {
                        t.value = v.sc_name;
                        t.title = v.sc_id;
                        _fun.hide(p);
                        document.body.style.overflow = "";
                    };
                    dg.appendChild(div);
                });
                dd.appendChild(dg);
                a.appendChild(dd);
            });
        }, function (msg) {
            _wd.info("获取学校失败！", "bgc24");
        })
    } //获取学校列表
    function toClass() {
        var t = event.target,
            p = t.parentNode,
            dt = p.querySelector("[name=schoolname]"),
            da = p.querySelector("[name=classdate]"),
            code = dt.title,
            time = da.value.slice(0, 4);
        if (!code) {
            _wd.info("请选择学校！", "bgc5e");
            dt.click();
            return;
        }
        if (!time) {
            _wd.info("请选择入学年级！", "bgc5e");
            da.click();
            return;
        }
        var para = {
            token: _token,
            userguid: _userguid,
            admdivcode1: code,
            industrycode: time
        };
        console.log("para:class/retrievebyai", para);
        _fun.ajax_formdata(_wit.path.server + "mavenwitlinkweb/class/retrievebyai.do", true, para, function (msg) {
            console.log(msg);
            var j = JSON.parse(msg);
            if (j.result >= 0 && j.message) {
                _fun.toDownList(t, function (a, p) {
                    var dd = document.createElement("div"),
                        l = j.message,
                        dg = document.createDocumentFragment();
                    dd.className = "relative HN4M HX24M ML A11 ofa";
                    dd.id = "classList";
                    a.innerHTML = "";
                    var div = document.createElement("DIV");
                    div.innerHTML = '<input type="text" class="FL relative C8M ALP H bgc10 ellips index10" placeholder="如没有您的班级，请手动添加全程" />' +
                        '<div class="FL B6M AC H bgc105">新建</div>';
                    div.querySelector("div").onclick = function () {
                        return;
                        var ipt = this.previousElementSibling;
                        if (ipt.value.trim().length <= 0) {
                            ipt.focus();
                            return;
                        }
                        _fun.hide(p);
                        document.body.style.position = "";
                        document.body.style.overflow = "";
                        var name = ipt.value.trim(),
                            linse = code + time + ("00" + ++j.message.length).slice(0, 3),
                            win = window.open("../cloud/cloud_cata.html");
                        win.addEventListener("load", function () {
                            win.winAdd({
                                license: linse,
                                admValue: dt.value,
                                admTitle: code,
                                ind: time,
                                name: name
                            });
                            return;
                            win.document.querySelector("#navList").children[4].click();
                            win.document.querySelector("#ipt_id").value = linse;
                            win.document.querySelector("#adm_div_code1").innerHTML = dt.value;
                            win.document.querySelector("#adm_div_code1").title = code;
                            win.document.querySelector("#industry_code").innerHTML = time;
                            win.document.querySelector("#industry_code").title = time;
                            win._fun.show(win._da);
                            win.document.body.style.position = "fixed"; //兼容移动端除了chrome外浏览器hidden无法生效
                            win.document.body.style.overflow = "hidden";
                            win.initAdd(win._da, {license: linse, unit: name});
                        });
                    };
                    dg.appendChild(div);
                    l.forEach(function (v) {
                        div = document.createElement("div");
                        div.className = "relative W11 ALP H bgc18 ellips index10";
                        div.setAttribute("readonly", "true");
                        div.dataset.id = v.unit_id;
                        div.innerHTML = v.unit_name;
                        div.onclick = function () {
                            t.value = v.unit_name;
                            t.title = v.unit_id;
                            _fun.hide(p);
                            //                            _fun.toConfirm("是否加入此班级云录！", function () {
                            //                                _page = 4;
                            //                                _info = myinfo.perobjectjson;
                            //                                join({name: v.unit_name, license: v.unit_id});
                            //                            }, {yes: "加入", no: "取消"});
                            document.body.style.position = "";
                            document.body.style.overflow = "";
                        };
                        dg.appendChild(div);
                    });
                    dd.appendChild(dg);
                    a.appendChild(dd);
                });
            } else {
                _wd.info("获取班级失败！", "bgc24");
            }
        });
    } //生成学校目录
</script>
